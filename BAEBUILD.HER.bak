#!/bin/bash
# === BAEBUILD.HER ===
# BAEs'R'Us — Plug-and-Play Federation Agent Utility

set -e  # Exit on error

# -- SANITY STRUCTURE CHECK --
if [[ ! -d .git || ! -d BAEs ]]; then
  echo "ERROR: Must run BAEBUILD.HER from your repo root (where .git and BAEs/ exist)."
  exit 1
fi

echo "---------------------------------------------"
echo "  BAEBUILD.HER : BAEs'R'Us Agent Automation  "
echo "---------------------------------------------"
read -p "Enter BAE Agent Number (e.g., 004): " BAENUM
read -p "Enter Agent Name (e.g., La'Bella The Programmer): " AGENTNAME
read -p "Action: (b)uild new, (u)pgrade, or (r)eplace files? [b/u/r]: " MODE

BAEDIR="BAEs/BAE${BAENUM}"

mkdir -p "$BAEDIR"

for FILEBASENAME in README.md identity.yaml; do
  TARGET="$BAEDIR/$FILEBASENAME"
  echo ""
  echo "== Federation BAEs'R'Us • $FILEBASENAME for BAE:${BAENUM} (${AGENTNAME}) =="

  if [[ "$MODE" != "b" && -f "$TARGET" ]]; then
    # Show diff and allow skipping or editing
    echo "Existing $FILEBASENAME found. Showing diff (if any):"
    git diff "$TARGET" || true
    read -p "Edit (e), Overwrite (o), or Skip (s) this file? [e/o/s]: " ANSWER
    if [[ "$ANSWER" == "s" ]]; then
      echo " - Skipping $FILEBASENAME."
      continue
    elif [[ "$ANSWER" == "e" ]]; then
      nano "$TARGET"
      echo " - $FILEBASENAME updated via nano."
      continue
    fi
    # else fall through to overwrite below
  fi

  # Create new or overwrite
  echo "Launching nano for $FILEBASENAME (BAE:${BAENUM})."
  echo "(Use nano to edit/paste your content. Save with Ctrl+O and exit with Ctrl+X.)"
  sleep 1
  nano "$TARGET"
  echo " - $FILEBASENAME updated!"
done

# Optional: log and Dockerfile
read -p "Add (l)og file, (d)ockerfile, (b)oth, or (n)one? [l/d/b/n]: " LOGD
if [[ "$LOGD" == "l" || "$LOGD" == "b" ]]; then
  touch "$BAEDIR/BAE${BAENUM}.log"
  echo " - Log

